(()=>{"use strict";var e,t={999:(e,t,a)=>{const r=window.dscc;function n(e){if(!Array.isArray(e))throw new Error("Input data must be an array");var t=new Map;return e.forEach((function(e,a){try{if(!e.date||!e.value)return;var r=(o=e.date,(i=new Date(o)).setHours(0,0,0,0),i.setDate(i.getDate()-i.getDay()),i),n=r.toISOString();t.has(n)||t.set(n,{date:r,value:0,target:null,historicalValue:null,count:0});var l=t.get(n);l.value+=e.value,null!=e.target&&(l.target=(l.target||0)+e.target),null!=e.historicalValue&&(l.historicalValue=(l.historicalValue||0)+e.historicalValue),l.count++}catch(e){}var o,i})),Array.from(t.values()).map((function(e){return{date:e.date,value:e.value/e.count,target:e.target?e.target/e.count:null,historicalValue:e.historicalValue?e.historicalValue/e.count:null}})).sort((function(e,t){return e.date-t.date}))}function l(e){if(!Array.isArray(e)||0===e.length)return null;try{var t,a=new Date(e[e.length-1].date),r=e[e.length-1].value,n=new Date(a.getFullYear(),a.getMonth(),1),l=null===(t=e.find((function(e){return new Date(e.date)>=n})))||void 0===t?void 0:t.historicalValue;return l?(r-l)/l*100:null}catch(e){return null}}function o(e){if(!Array.isArray(e)||0===e.length)return null;try{var t,a=new Date(e[e.length-1].date),r=e[e.length-1].value,n=Math.floor(a.getMonth()/3),l=new Date(a.getFullYear(),3*n,1),o=null===(t=e.find((function(e){return new Date(e.date)>=l})))||void 0===t?void 0:t.historicalValue;return o?(r-o)/o*100:null}catch(e){return null}}function i(e){if(!Array.isArray(e)||0===e.length)return null;try{var t,a=new Date(e[e.length-1].date),r=e[e.length-1].value,n=new Date(a.getFullYear(),0,1),l=null===(t=e.find((function(e){return new Date(e.date)>=n})))||void 0===t?void 0:t.historicalValue;return l?(r-l)/l*100:null}catch(e){return null}}var u=a(27),c=a(623),s=a(983),d=a(26),v=a(98),h=a(233),f=a(90),g=a(662),m=a(454),y=a(846),p=a(947);function w(e,t,a){try{for(;e.firstChild;)e.removeChild(e.firstChild);var r={top:40,right:20,bottom:50,left:60},n=e.clientWidth||600,l=e.clientHeight||400,o=Math.max(n-r.left-r.right,200),i=Math.max(l-r.top-r.bottom,200),g=(0,u.A)(e).append("svg").attr("width",o+r.left+r.right).attr("height",i+r.top+r.bottom).append("g").attr("transform","translate(".concat(r.left,",").concat(r.top,")"));if(a.graphNumber&&g.append("text").attr("x",-r.left).attr("y",-r.top/2).attr("class","graph-number").text("Graph ".concat(a.graphNumber)),!Array.isArray(t)||0===t.length)throw new Error("Invalid or empty data array");var w=(0,m.A)(t,(function(e){return e.date})),D=(0,y.A)(t,(function(e){return Math.max(e.value||0,e.target||0,e.historicalValue||0)}));if(!w[0]||!w[1]||!D)throw new Error("Invalid data ranges");var A=(0,c.A)().domain(w).range([0,o]),k=(0,s.A)().domain([0,1.1*D]).range([i,0]).nice();try{var T,V;!function(e,t,a,r,n){try{var l=(0,f.l7)(t).ticks(n.isWeeklyView?6:12).tickFormat((0,p.DC)(n.isWeeklyView?"%m/%d":"%b %Y"));e.append("g").attr("transform","translate(0,".concat(r,")")).attr("class","x-axis").call(l),e.append("g").attr("class","y-axis").call((0,f.V4)(a))}catch(e){throw e}}(g,A,k,i,a),function(e,t,a,r,n){var l,o=(0,d.A)().x((function(e){return a(e.date)})).y((function(e){return r(e.value)}));e.append("path").datum(t).attr("class","main-line").attr("fill","none").attr("stroke",(null===(l=n.lineColor)||void 0===l||null===(l=l.value)||void 0===l?void 0:l.color)||"#3366CC").attr("stroke-width",2).attr("d",o)}(g,t,A,k,a),null!==(T=a.showHistorical)&&void 0!==T&&T.value&&function(e,t,a,r,n){var l,o=(0,d.A)().defined((function(e){return null!=e.historicalValue})).x((function(e){return a(e.date)})).y((function(e){return r(e.historicalValue)}));e.append("path").datum(t.filter((function(e){return null!=e.historicalValue}))).attr("class","historical-line").attr("fill","none").attr("stroke",(null===(l=n.historicalLineColor)||void 0===l||null===(l=l.value)||void 0===l?void 0:l.color)||"#FF9999").attr("stroke-width",2).attr("stroke-dasharray","4,4").attr("opacity",.7).attr("d",o)}(g,t,A,k,a),null!==(V=a.showTargets)&&void 0!==V&&V.value&&function(e,t,a,r,n){var l,o=(0,v.Ay)().type(h.A).size(64);e.selectAll(".target-triangle").data(t.filter((function(e){return null!=e.target}))).enter().append("path").attr("class","target-triangle").attr("d",o).attr("transform",(function(e){return"translate(".concat(a(e.date),",").concat(r(e.target),")")})).attr("fill",(null===(l=n.targetColor)||void 0===l||null===(l=l.value)||void 0===l?void 0:l.color)||"#00AA00")}(g,t,A,k,a),function(e,t,a,r){e.selectAll(".value-label").data(t).enter().append("text").attr("class","value-label").attr("x",(function(e){return a(e.date)})).attr("y",(function(e){return r(e.value)-10})).attr("text-anchor","middle").text((function(e){return b(e.value)}))}(g,t,A,k)}catch(e){throw e}}catch(t){e.innerHTML='\n      <div class="error-message">\n        Unable to render graph: '.concat(t.message,"\n      </div>\n    ")}}function b(e){try{return null!=e?(0,g.GP)(",.0f")(e):"N/A"}catch(e){return"Error"}}function D(e){try{return null!=e?(0,g.GP)("+.1f")(e)+"%":"N/A"}catch(e){return"Error"}}function A(e){try{var t=new Date(e);if(isNaN(t.getTime()))throw new Error("Invalid date");return t.setDate(1),t.setHours(0,0,0,0),t}catch(e){throw e}}var k="#3366CC",T=!0,V="#FF9999",C=!0,M="#00AA00",x=1;r.subscribeToData((function(e){try{var t,a,r,u,c,s,d,v,h;if(!e||!e.tables||!e.tables.DEFAULT)throw new Error("No data received from Looker Studio");var f=document.getElementById("container");f||((f=document.createElement("div")).id="container",f.className="twelve-month-graph-container",document.body.appendChild(f)),f.innerHTML="";var g={lineColor:(null===(t=e.style)||void 0===t||null===(t=t.lineColor)||void 0===t||null===(t=t.value)||void 0===t?void 0:t.color)||k,showHistorical:null!==(a=null===(r=e.style)||void 0===r||null===(r=r.showHistorical)||void 0===r?void 0:r.value)&&void 0!==a?a:T,historicalLineColor:(null===(u=e.style)||void 0===u||null===(u=u.historicalLineColor)||void 0===u||null===(u=u.value)||void 0===u?void 0:u.color)||V,showTargets:null!==(c=null===(s=e.style)||void 0===s||null===(s=s.showTargets)||void 0===s?void 0:s.value)&&void 0!==c?c:C,targetColor:(null===(d=e.style)||void 0===d||null===(d=d.targetColor)||void 0===d||null===(d=d.value)||void 0===d?void 0:d.color)||M,graphNumber:(null===(v=e.style)||void 0===v||null===(v=v.graph_number)||void 0===v?void 0:v.value)||x,isWeeklyView:!1},m=function(e){try{var t,a,r=e.tables,n=e.fields;if(null===(t=n.dateDimension)||void 0===t||null===(t=t[0])||void 0===t||!t.name||null===(a=n.valueMeasure)||void 0===a||null===(a=a[0])||void 0===a||!a.name)throw new Error("Required fields (date dimension and value measure) are missing");return r.DEFAULT.map((function(e,t){try{var a,r,l=e[n.dateDimension[0].name],o=e[n.valueMeasure[0].name],i=null!==(a=n.targetMeasure)&&void 0!==a&&a[0]?e[n.targetMeasure[0].name]:null,u=null!==(r=n.historicalValueMeasure)&&void 0!==r&&r[0]?e[n.historicalValueMeasure[0].name]:null,c=new Date(l);if(isNaN(c.getTime()))throw new Error("Invalid date value at row ".concat(t+1,": ").concat(l));var s=parseFloat(o);return isNaN(s),{date:c,value:s||0,target:i&&parseFloat(i)||null,historicalValue:u&&parseFloat(u)||null}}catch(e){return null}})).filter((function(e){return null!==e}))}catch(e){throw new Error("Failed to parse data: ".concat(e.message))}}(e);if(!m||0===m.length)return void(f.innerHTML='<div class="error">No valid data available to display</div>');var y=n(m),p=new Date;p.setMonth(p.getMonth()-12);var E=y.filter((function(e){return e.date>=p})).reduce((function(e,t){var a=A(t.date).toISOString();return e[a]||(e[a]={date:A(t.date),value:0,target:t.target,historicalValue:t.historicalValue,count:0}),e[a].value+=t.value,e[a].count++,e}),{}),O=Object.values(E).map((function(e){return{date:e.date,value:e.value/e.count,target:e.target,historicalValue:e.historicalValue}})).sort((function(e,t){return e.date-t.date}));if(!O||0===O.length)return void(f.innerHTML='<div class="error">Insufficient data for visualization</div>');var N=function(e){if(!Array.isArray(e)||0===e.length)return{weekOverWeek:null,yearOverYear:null,monthToDate:null,quarterToDate:null,yearToDate:null};try{var t,a=e[e.length-1].value,r=null===(t=e[e.length-2])||void 0===t?void 0:t.value,n=e[e.length-1].historicalValue;return{weekOverWeek:null!=r?(a-r)/r*100:null,yearOverYear:null!=n?(a-n)/n*100:null,monthToDate:l(e),quarterToDate:o(e),yearToDate:i(e)}}catch(e){return{weekOverWeek:null,yearOverYear:null,monthToDate:null,quarterToDate:null,yearToDate:null}}}(O);w(f,O,g);var F=null===(h=O[O.length-1])||void 0===h?void 0:h.value;!function(e,t){try{var a=document.createElement("div");a.className="box-scores",[{label:"Last Week",value:b(t.lastWeek)},{label:"WoW",value:D(t.wow)},{label:"YoY",value:D(t.yoy)},{label:"MTD",value:D(t.mtd)},{label:"QTD",value:D(t.qtd)},{label:"YTD",value:D(t.ytd)}].forEach((function(e){var t=document.createElement("div");t.className="score-item";var r=document.createElement("div");r.className="score-label",r.textContent=e.label;var n=document.createElement("div");n.className="score-value",n.textContent=e.value,t.appendChild(r),t.appendChild(n),a.appendChild(t)})),e.appendChild(a)}catch(t){e.innerHTML+='\n      <div class="error-message">\n        Unable to render box scores: '.concat(t.message,"\n      </div>\n    ")}}(f,{lastWeek:F||0,wow:N.weekOverWeek,yoy:N.yearOverYear,mtd:N.monthToDate,qtd:N.quarterToDate,ytd:N.yearToDate})}catch(e){var L=document.getElementById("container");L&&(L.innerHTML='\n        <div class="error">\n          Unable to display visualization. Please check your data configuration.\n          '.concat(e.message?"<br>Error: ".concat(e.message):"","\n        </div>\n      "))}}),{transform:r.objectTransform,style:!0})}},a={};function r(e){var n=a[e];if(void 0!==n)return n.exports;var l=a[e]={exports:{}};return t[e](l,l.exports,r),l.exports}r.m=t,e=[],r.O=(t,a,n,l)=>{if(!a){var o=1/0;for(s=0;s<e.length;s++){for(var[a,n,l]=e[s],i=!0,u=0;u<a.length;u++)(!1&l||o>=l)&&Object.keys(r.O).every((e=>r.O[e](a[u])))?a.splice(u--,1):(i=!1,l<o&&(o=l));if(i){e.splice(s--,1);var c=n();void 0!==c&&(t=c)}}return t}l=l||0;for(var s=e.length;s>0&&e[s-1][2]>l;s--)e[s]=e[s-1];e[s]=[a,n,l]},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={694:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var n,l,[o,i,u]=a,c=0;if(o.some((t=>0!==e[t]))){for(n in i)r.o(i,n)&&(r.m[n]=i[n]);if(u)var s=u(r)}for(t&&t(a);c<o.length;c++)l=o[c],r.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return r.O(s)},a=self.webpackChunklooker_custom_graphs=self.webpackChunklooker_custom_graphs||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var n=r.O(void 0,[121],(()=>r(999)));n=r.O(n);var l=window;for(var o in n)l[o]=n[o];n.__esModule&&Object.defineProperty(l,"__esModule",{value:!0})})();